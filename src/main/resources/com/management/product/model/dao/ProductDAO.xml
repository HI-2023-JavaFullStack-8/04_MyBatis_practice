<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.management.product.model.dao.ProductDAO">

    <resultMap id="productResultMap" type="com.management.product.model.dto.ProductDTO">
        <id property="productCode" column="product_code"/>
        <result property="productName" column="product_name"/>
        <result property="originCost" column="origin_cost"/>
        <result property="releaseDate" column="release_date"/>
        <result property="discountRate" column="discount_rate"/>
        <result property="salesQuantity" column="sales_quantity"/>
        <result property="stockQuantity" column="stock_quantity"/>
        <result property="categoryCode" column="category_code"/>
        <result property="productionStatus" column="production_status"/>
    </resultMap>

    <select id="selectAllProductList" resultMap="productResultMap">
        SELECT product_code
                ,product_name
                ,origin_cost
                ,release_date
                ,discount_rate
                ,sales_quantity
                ,stock_quantity
                ,category_code
                ,production_status
          FROM product_info
         WHERE production_status = 'Y'
    </select>

    <select id="selectProductByCondition" parameterType="SearchCondition" resultMap="productResultMap">
        SELECT product_code
             ,product_name
             ,origin_cost
             ,release_date
             ,discount_rate
             ,sales_quantity
             ,stock_quantity
             ,category_code
             ,production_status
        FROM product_info
        <choose>
            <when test="option=='productName'">
            <where>
                product_name LIKE CONCAT('%', #{ value }, '%')
            </where>
            </when>

            <when test="option=='salesStore'">
            <where>
                <if test="value=='백화점'">
                    discount_rate = 0;
                </if>
                <if test="value=='아울렛'">
                    <![CDATA[
                    AND discount_rate > 1
                    ]]>
                </if>
            </where>
            </when>

            <when test="option=='newProduct'">
                <where>
                <![CDATA[
                AND release_date >= #{ value }
                ]]>
                </where>
            </when>

            <when test="option=='nonProduction'">
            <where>
                production_status = 'N'
            </where>
            </when>
        </choose>
    </select>

    <insert id="insertProduct" parameterType="com.management.product.model.dto.ProductDTO">
        INSERT INTO PRODUCT_INFO(
                                  product_name
                                  ,origin_cost
                                  ,release_date
                                  ,discount_rate
                                  ,sales_quantity
                                  ,stock_quantity
                                  ,category_code
                                  ,production_status
                                 )
        VALUES (
                #{ productName }
                ,#{ originCost }
                ,#{ releaseDate }
                ,#{ discountRate }
                ,#{ salesQuantity }
                ,#{ stockQuantity }
                ,#{ categoryCode }
                ,#{ productionStatus }
               )
    </insert>

    <update id="updateProduct" parameterType="com.management.product.model.dto.ProductDTO">
        UPDATE product_info
        <trim prefix="SET" prefixOverrides=",">
            <if test="productName != null and productName != ''">
                product_name = #{ productName }
            </if>
            <if test="originCost != null and originCost != ''">
                ,origin_cost = #{ originCost }
            </if>
            <if test="releaseDate != null and releaseDate != ''">
                ,release_date = #{ releaseDate }
            </if>
            <if test="discountRate != null and discountRate != ''">
                ,discount_rate = #{ discountRate }
            </if>
            <if test="salesQuantity != null and salesQuantity != ''">
                ,sales_quantity = #{ salesQuantity }
            </if>
            <if test="stockQuantity != null and stockQuantity != ''">
                ,stock_quantity = #{ stockQuantity }
            </if>
            <if test="categoryCode != null and categoryCode != ''">
                ,category_code = #{ categoryCode }
            </if>
            <if test="productionStatus != null and productionStatus != ''">
                ,production_status = #{ productionStatus }
            </if>
        </trim>
        WHERE product_code = #{ productCode }
    </update>

    <delete id="deleteProduct" parameterType="hashmap">
        DELETE
          FROM product_info
         WHERE product_code = #{ productCode }
    </delete>

</mapper>
